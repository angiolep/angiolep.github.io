<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <meta name="author" content="Paolo Angioletti">  
    <link rel="shortcut icon" href="../../../img/favicon.ico">

    <title>Payload Handling - akka-wamp-0.9.0</title>

    <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../../css/base.css" rel="stylesheet">
    <link href="../../../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../../..">akka-wamp-0.9.0</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../../router/">Router</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Client <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../actor/">Actor based API</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Future based API</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../overview/">Overview</a>
</li>

        
            
<li >
    <a href="../session/">Session Handling</a>
</li>

        
            
<li >
    <a href="../pubsub/">Publish and Subscribe</a>
</li>

        
            
<li >
    <a href="../rpc/">Remote Procedure Calls</a>
</li>

        
            
<li class="active">
    <a href="./">Payload Handling</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../../stream/">Stream based API</a>
</li>

                        
                            
<li >
    <a href="../../config/">Configuration</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../../messages/">Messages</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../rpc/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../../stream/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="first-level active"><a href="#payload-handling">Payload Handling</a></li>
        
            <li class="second-level"><a href="#receive-payloads">Receive payloads</a></li>
            
                <li class="third-level"><a href="#access-parsed-dataarguments">Access parsed data/arguments</a></li>
            
                <li class="third-level"><a href="#access-unparsed-content">Access unparsed content</a></li>
            
                <li class="third-level"><a href="#examples">Examples</a></li>
            
        
            <li class="second-level"><a href="#send-payloads">Send payloads</a></li>
            
        
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="payload-handling">Payload Handling</h1>
<p>WAMP messages, formatted as textual JSON or binary MsgPack, are transmitted by an underlying transport like WebSocket or RawTCP. Messages are all made of few headers and an optional payload. </p>
<pre><code class="text">frame2                  frame1                             
.-------------.        .-------------,---------.    
| payload ... |  --&gt;   | ... payload | headers |  --&gt;  
'-------------'        '-------------`---------'     
</code></pre>

<p>The payload contains application data either as a list or as a dictionary of arguments. The payload is always at the end of the message and for some applications (such a BigData or Multimedia Streaming applications), it could be of such a big size that some transports have to split messages in frames.</p>
<h2 id="receive-payloads">Receive payloads</h2>
<p>Akka Wamp provides efficient deserializers, implemented using streaming technologies, which do not eagerly parse the contents of incoming payloads but rather return lazy structures to defer parsing to the very last moment.  That lazy structures in question are implemented internally as <code>LazyTextPayload</code> and <code>LazyBinaryPayload</code> types.</p>
<pre><code class="text">,-------------.  holds     ,-----------.
|PayloadHolder|----------&gt;&gt;|  Payload  |
`-------------'            `-----+-----'
                                 ^
                                 | inherits
                   .-------------+-------------. 
                   |                           |
           ,-------+-------.          ,--------+--------.
           |LazyTextPayload|          |LazyBinaryPayload|
           `---------------'          `-----------------'
</code></pre>

<p>Incoming messages that can hold a lazy payload are summarized by the following table alongside the client role that receives them: </p>
<table>
<thead>
<tr>
<th>Message</th>
<th>Receiver</th>
<th>Handler</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Event</code></td>
<td>Subscriber</td>
<td><code>EventHandler</code></td>
</tr>
<tr>
<td><code>Invocation</code></td>
<td>Callee</td>
<td><code>InvocationHandler</code></td>
</tr>
<tr>
<td><code>Result</code></td>
<td>Caller</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="access-parsed-dataarguments">Access parsed data/arguments</h3>
<p>You can let Akka Wamp lazily parse the content of incoming payloads on behalf of your client. Your subscriber, callee or caller can access data/arguments parsed by Akka Wamp as (future of) Scala collections of arbitrary types but deserialized with default data type bindings. </p>
<p>For example, a subscriber client can access parsed event data as follows:</p>
<pre><code class="scala">val handler: EventHandler = { event =&gt;
  val data: Future[List[Any] = event.data
  val kwdata: Future[Map[String, Any]] = event.kwdata

  // ...
}
</code></pre>

<p>Similarly, a callee client can access parsed invocation arguments as follows:</p>
<pre><code class="scala">val handler: InvocationHandler = { invocation =&gt;
  val args: Future[List[Any] = invocation.args
  val kwargs: Future[Map[String, Any]] = invocation.kwargs

  // ...
}
</code></pre>

<h4 id="default-data-type-bindings">Default data type bindings</h4>
<p>By default, Akka Wamp makes use of either the embedded <a href="https://github.com/FasterXML/jackson-module-scala">Jackson JSON Parser</a> (for textual data) or the embedded <a href="https://github.com/msgpack/msgpack-scala">MsgPack Parser</a> (for binary data) and deserializes incoming data/arguments to Scala collection whose values match the following data type bindings:</p>
<table>
<thead>
<tr>
<th>JSON</th>
<th>MsgPack</th>
<th>Scala</th>
</tr>
</thead>
<tbody>
<tr>
<td>string</td>
<td></td>
<td>java.lang.<code>String</code></td>
</tr>
<tr>
<td>number</td>
<td></td>
<td>java.lang.<code>Integer</code>, java.lang.<code>Long</code>, java.lang.<code>Double</code></td>
</tr>
<tr>
<td>object</td>
<td></td>
<td>scala.collection.immutable.<code>Map[String, _]</code></td>
</tr>
<tr>
<td>array</td>
<td></td>
<td>scala.collection.immutable.<code>List[_]</code></td>
</tr>
<tr>
<td>true</td>
<td></td>
<td>java.lang.<code>Boolean</code></td>
</tr>
<tr>
<td>false</td>
<td></td>
<td>java.lang.<code>Boolean</code></td>
</tr>
<tr>
<td>null</td>
<td></td>
<td>scala.<code>None</code></td>
</tr>
</tbody>
</table>
<h4 id="custom-data-type-bindings">Custom data type bindings</h4>
<p>TBD</p>
<h3 id="access-unparsed-content">Access unparsed content</h3>
<blockquote>
<p>WARNING<br />
This is an experimental feature that has not been released yet!</p>
</blockquote>
<p>Your clients (either of role subscriber, callee or caller) can access incoming unparsed payload content by consuming an Akka Stream source. It comes in handy for those applications exchanging huge amount of data. But bear in mind that you will be put in charge of parsing payload content appropriately:</p>
<pre><code class="scala">import akka.stream.scaladsl._
import akka.wamp.serialization._

val handler: EventHandler = { event =&gt;
  event.payload match {
    case payload: BinaryPayload =&gt;
      log.warn(&quot;Unexpected binaray payload&quot;)

    case payload: TextPayload =&gt;
      val source: Source[String] = payload.source
      // ... consume/parse the Akka Stream source ...
      ()
  }
  // ...
}
</code></pre>

<p>You can match the payload against <code>TextPayload</code> or <code>BinaryPayload</code>, get its Akka Stream source, then create whatever Akka Stream graph you need (composing flows and sink) and finally run the stream to parse the payload contents at your best convenience.</p>
<h3 id="examples">Examples</h3>
<p>TBD</p>
<h4 id="json">JSON</h4>
<p>TBD</p>
<h4 id="yaml">YAML</h4>
<p>TBD</p>
<h4 id="msgpack">MsgPack</h4>
<p>TBD</p>
<h4 id="apache-avro">Apache Avro</h4>
<p>TBD</p>
<h2 id="send-payloads">Send payloads</h2>
<p>TBD</p></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
    </footer>

    <script src="../../../js/jquery-1.10.2.min.js"></script>
    <script src="../../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '../../..';
    </script>
    <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
    <script src="../../../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
