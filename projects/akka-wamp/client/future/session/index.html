<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <meta name="author" content="Paolo Angioletti">  
    <link rel="shortcut icon" href="../../../img/favicon.ico">

    <title>Session Handling - akka-wamp-0.10.0</title>

    <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../../css/base.css" rel="stylesheet">
    <link href="../../../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../../..">akka-wamp-0.10.0</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../../router/">Router</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Client <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../actor/">Actor based API</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Future based API</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../overview/">Overview</a>
</li>

        
            
<li class="active">
    <a href="./">Session Handling</a>
</li>

        
            
<li >
    <a href="../pubsub/">Publish and Subscribe</a>
</li>

        
            
<li >
    <a href="../rpc/">Remote Procedure Calls</a>
</li>

        
            
<li >
    <a href="../payload/">Payload Handling</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../../stream/">Stream based API</a>
</li>

                        
                            
<li >
    <a href="../../config/">Configuration</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../../messages/">Messages</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../overview/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../pubsub/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="first-level active"><a href="#session-handling">Session Handling</a></li>
        
            <li class="second-level"><a href="#create-clients">Create clients</a></li>
            
                <li class="third-level"><a href="#configuration">Configuration</a></li>
            
                <li class="third-level"><a href="#multiplicity">Multiplicity</a></li>
            
                <li class="third-level"><a href="#execution-context">Execution context</a></li>
            
        
            <li class="second-level"><a href="#establish-connections">Establish connections</a></li>
            
                <li class="third-level"><a href="#recover">Recover</a></li>
            
        
            <li class="second-level"><a href="#open-sessions">Open sessions</a></li>
            
                <li class="third-level"><a href="#shortcut">Shortcut</a></li>
            
                <li class="third-level"><a href="#recover_1">Recover</a></li>
            
        
            <li class="second-level"><a href="#close-sessions">Close sessions</a></li>
            
        
            <li class="second-level"><a href="#disconnect-transports">Disconnect transports</a></li>
            
        
            <li class="second-level"><a href="#terminate-clients">Terminate clients</a></li>
            
        
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="session-handling">Session Handling</h1>
<pre><code class="scala">import akka.wamp.client._
val client = Client(&quot;myapp&quot;)

implicit val ec = client.executionContext

val session = client
  .connect(
    url = &quot;ws://localhost:8080/router&quot;,
    subprotocol = &quot;wamp.2.json&quot;)
  .openSession(
    realm = &quot;akka.wamp.realm&quot;,
    roles = Set(&quot;subscriber&quot;)
  )
}
</code></pre>

<p>Create the client and establish connections to open sessions.</p>
<h2 id="create-clients">Create clients</h2>
<pre><code class="scala">import akka.wamp.client._
val client = Client(&quot;myapp&quot;)
</code></pre>

<p>Create the client by invoking the <code>Client</code> companion object factory method with the following arguments</p>
<ul>
<li>
<p><code>name</code><br />
   The unique name of the client (default is <code>"default"</code>)</p>
</li>
<li>
<p><code>config</code><br />
   The configuration object (default is <code>ConfigFactory.load()</code> as per standard behaviour of <a href="https://github.com/typesafehub/config#standard-behavior">TypeSafe Config</a>)</p>
</li>
</ul>
<p>The factory method creates an <a href="http://doc.akka.io/docs/akka/2.4.10/general/actor-systems.html">Akka ActorSystem</a> named after the client and configured with the given configuration object. </p>
<h3 id="configuration">Configuration</h3>
<p>TBD</p>
<h3 id="multiplicity">Multiplicity</h3>
<p>In Akka Wamp, one client can establish many connections but each connection can open only one session.</p>
<pre><code>    ,--------.  1      0..n  ,------------.  1      0..1  ,---------. 
    | Client |  -----------  | Connection |  -----------  | Session | 
    `--------'               `------------'               `---------'
</code></pre>

<p>Bear in mind that, though you could create as many client as you wish, its actor system is a heavyweight structure that allocates 1..n threads. So you're advised to create <em>one client per logical application</em>.</p>
<h3 id="execution-context">Execution context</h3>
<p>All of the operation provided by client, connection and sessions objects always return futures. In order to execute callbacks and operations, futures need something called an <a href="http://doc.akka.io/docs/akka/2.4.10/scala/futures.html">ExecutionContext</a>. You can import the existing <code>client.executionContext</code> as implicit in scope:</p>
<pre><code class="scala">implicit val ec = client.executionContext
</code></pre>

<p>or create your own.</p>
<h2 id="establish-connections">Establish connections</h2>
<pre><code class="scala">import scala.concurrent.Future

val conn1: Future[Connection] = client
  .connect(
    url = &quot;ws://localhost:8080/router&quot;,
    subprotocol = &quot;wamp.2.json&quot;)

val conn2 = client
  .connect(
    url = &quot;wss://secure.host.net:443/wamp&quot;,
    subprotocol = &quot;wamp.2.msgpack&quot;)    
</code></pre>

<p>Establish a connection to a router invoking the client <code>connect()</code> method which accepts <code>url</code> and <code>subprotocol</code> arguments as documented for the <a href="../../../messages#Connect"><code>Connect</code></a> message constructor. </p>
<p>You can establish as many connections as you wish (to the same or to different routers) as the connect method returns a distinct (future of) connection.</p>
<h3 id="recover">Recover</h3>
<p>You can either recover or <em>"give up"</em> when the (future of) connection fails. To recover from failures (such as <code>ConnectionException</code> thrown when router cannot accept connection) you can compose <code>recoverWith</code> to attempt another connection (maybe to a fallback router):</p>
<pre><code class="scala">val conn1: Future[Connection] = client
  .connect(
    url = &quot;ws://localhost:8080/router&quot;)
  .recoverWith { 
    case ex: ConnectionException =&gt; client
      .connect(
        url = &quot;ws://fallback.host.net:9999/path&quot;)
  }
</code></pre>

<p>As last resort, instead of recovering, you could decide to <em>"give up"</em> a callback function <code>onFailure</code> that terminates the application:</p>
<pre><code class="scala">conn.onFailure {
  case ex: Throwable =&gt;
    client.terminate().map(_ =&gt; System.exit(-1))
}
</code></pre>

<h2 id="open-sessions">Open sessions</h2>
<pre><code class="scala">val session1: Future[Session] = conn1.flatMap(
  _.openSession(
    realm = &quot;akka.wamp.realm&quot;,
    roles = Set(&quot;subscriber&quot;)))

val session2 = conn2.flatMap(
  _.openSession(
    roles = Set(&quot;publisher&quot;, &quot;callee&quot;)))    
</code></pre>

<p>A (future of) connection can be mapped to a (future of) session by just invoking the connection <code>openSession()</code> method which accepts <code>realm</code> and <code>roles</code> arguments as documented for the <a href="../../../messages#Hello"><code>Hello</code></a> message constructor. </p>
<p>You can open only one session per connection. Therefore, if you wish to open a second session then you must establish a second connection (using the same client or a different one).</p>
<h3 id="shortcut">Shortcut</h3>
<p>You can shortcut connection establishment and session opening in one single concise statement by invoking <code>openSession()</code> on the client rather than on the connection:</p>
<pre><code class="scala">val session: Future[Session] = client
  .openSession(
    url = &quot;ws://some.host.net:8080/ws&quot;,
    subprotocol = &quot;wamp.2.json&quot;,
    realm = &quot;akka.wamp.realm&quot;,
    roles = Set(&quot;subscriber&quot;, &quot;caller&quot;))
</code></pre>

<p>The client <code>openSession()</code> method accepts all of the <code>url</code>, <code>subprotocol</code>, <code>realm</code> and <code>details</code> arguments mentioned above. It establishes a new connection and opens a new session each time you call it.</p>
<h3 id="recover_1">Recover</h3>
<p>You can either recover or <em>"give up"</em> when the (future of) session fails. To recover from failures (such as <code>AbortException</code> thrown when router doesn't attach to a realm) you can compose <code>recoverWith</code> to attempt another session opening (maybe to a fallback realm):</p>
<pre><code class="scala">val session: Future[Session] = client
  .openSession(
    realm = &quot;akka.wamp.realm&quot;)
  .recoverWith { 
    case ex: AbortException =&gt; client
      .openSession(
        realm = &quot;fallback.realm&quot;)
  }
</code></pre>

<p>As last resort, instead of recovering, you could decide to <em>"give up"</em> a callback function <code>onFailure</code> that just prints a log message:</p>
<pre><code class="scala">session.onFailure {
  case ex: Throwable =&gt; 
    log.error(ex.getMessage, ex)
}
</code></pre>

<h2 id="close-sessions">Close sessions</h2>
<p>TBD</p>
<h2 id="disconnect-transports">Disconnect transports</h2>
<p>TBD</p>
<h2 id="terminate-clients">Terminate clients</h2>
<p>TBD</p></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
    </footer>

    <script src="../../../js/jquery-1.10.2.min.js"></script>
    <script src="../../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '../../..';
    </script>
    <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
    <script src="../../../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
